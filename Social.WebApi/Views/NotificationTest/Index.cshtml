
@{
    ViewBag.Title = "Notification";
}


<div class="container">
    <div class="row">
        <h2>Real Time Notifications</h2>
    </div>
    <div class="row">
        <div class="col-md-2">
            <span>Conversation Id : <input id="txtConversationId" type="text" /></span>
            <button id="btnJoinConversation">Join Conversation</button>
            <button id="btnLeaveConversation">Leave Conversation</button>
        </div>
        <div class="col-md-10">
            <div id="discussion"></div>
        </div>
    </div>
</div>


@section scripts {
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script>
        $(function () {

            var hub = $.connection.notificationHub;
            hub.state.agentId = 1;
            hub.state.siteId = 10000;
            $.connection.logging = true;
            $.connection.hub.qs = { "siteId": "10000" };

            hub.client.conversationCreated = function (conversation) {
                console.log(conversation);
                $('#discussion').append("<p>" + htmlEncode("Conversation Created : " + conversation.id) + "</p > ");
            }
            hub.client.conversationUpdated = function (conversation) {
                console.log(conversation);
                $('#discussion').append("<p>" + htmlEncode("Conversation Updated : " + conversation.id) + "</p > ");
            }
            hub.client.facebookCommentCreated = function (messsage) {
                console.log(messsage);
                $('#discussion').append("<p>" + htmlEncode("Facebook comment created : " + messsage.id) + "</p > ");
            }
            hub.client.facebookMessageCreated = function (messsage) {
                console.log(messsage);
                $('#discussion').append("<p>" + htmlEncode("Facebook message created : " + messsage.id) + "</p > ");
            }
            hub.client.twitterTweetCreated = function (messsage) {
                console.log(messsage);
                $('#discussion').append("<p>" + htmlEncode("Twitter tweet created : " + messsage.id) + "</p > ");
            }
            hub.client.TwitterDirectMessageCreated = function (messsage) {
                console.log(messsage);
                $('#discussion').append("<p>" + htmlEncode("Twitter direct message created : " + messsage.id) + "</p > ");
            }

            $.connection.hub.start().done(function () {

                $("#btnJoinConversation").click(function () {
                    var conversationId = $("#txtConversationId").val();
                    if (conversationId) {
                        hub.server.joinConversation(conversationId);
                    }
                });
                $("#btnLeaveConversation").click(function () {
                    var conversationId = $("#txtConversationId").val();
                    if (conversationId) {
                        hub.server.leaveConversation(conversationId);
                    }
                });
            });
        });

        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}